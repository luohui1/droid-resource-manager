## 概述
该 Skill 是一个针对 Node.js、Express 和 Next.js API 路由的后端开发模式指南。它提供了一套标准化的架构模式、API 设计规范、数据库优化策略及服务器端最佳实践，旨在帮助开发者构建可扩展且易于维护的后端应用。

## 核心功能
- **架构模式实现**：涵盖了存储库模式（Repository Pattern）、服务层模式（Service Layer）和中间件模式，实现业务逻辑与数据访问的分离。
- **API 设计规范**：定义了标准的 RESTful API 结构及基于查询参数的过滤、排序和分页方法。
- **数据库性能优化**：提供了防止 N+1 查询、字段精简选择（Select only needed）以及通过存储过程处理事务的具体方案。
- **可靠性与安全性**：包含 JWT 身份验证、角色访问控制（RBAC）、频率限制（Rate Limiting）及带指数退避算法的重试机制。
- **系统运维支持**：提供了基于 Redis 的缓存策略、后台任务队列处理以及结构化日志记录方案。

## 使用场景
- **新项目搭建**：在启动 Node.js 或 Next.js 后端项目时，作为架构设计的参考标准。
- **代码重构**：将臃肿的控制器逻辑拆分为 Service 和 Repository 层，提升代码的可测试性。
- **性能调优**：解决数据库查询缓慢、接口响应延迟或高并发下的资源竞争问题。
- **安全加固**：为 API 添加统一的鉴权、权限校验和防刷限流机制。

## 使用方法
1. **定义数据层**：使用 Repository 模式封装数据库操作，确保数据访问逻辑的唯一性。
2. **编写业务逻辑**：在 Service 层处理复杂的业务规则，并调用 Repository 获取数据。
3. **配置 API 路由**：按照 RESTful 规范设置路由，并挂载身份验证和错误处理中间件。
4. **集成优化组件**：根据需求引入 Redis 缓存、任务队列或结构化日志记录。

## 注意事项
- **避免全量查询**：在数据库操作中严禁使用 `select *`，必须明确指定所需列以减少 I/O 开销。
- **警惕 N+1 问题**：在处理关联数据时，应使用批量查询（Batch Fetch）而非在循环中执行查询。
- **异常处理**：必须使用统一的错误处理器（ApiError），避免向客户端暴露敏感的系统堆栈信息。
- **事务一致性**：涉及多表写入的操作应优先使用数据库事务或存储过程（如 Supabase RPC）以保证原子性。